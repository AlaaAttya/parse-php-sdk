<html>
    <head>
        <script
            type="text/javascript"
            src="../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php

namespace Parse;
use Parse\Internal\ParseRelationOperation;

/**
 * ParseRelation - A class that is used to access all of the children of a many-to-many relationship. Each instance
 * of ParseRelation is associated with a particular parent object and key.
 *
 * @package  Parse
 * @author   Mohamed Madbouli &lt;mohamedmadbouli@fb.com&gt;
 */

class ParseRelation {

  /**
   * @var ParseObject - The parent of this relation.
   */
  private $parent;
  /**
   * @var string - The key of the relation in the parent object.
   */
  private $key;
  /**
   * @var string - The className of the target objects.
   */
  private $targetClassName;

  /**
   * Creates a new Relation for the given parent object, key and class name of target objects.
   *
   * @param ParseObject $parent          The parent of this relation.
   * @param string      $key             The key of the relation in the parent object.
   * @param string      $targetClassName The className of the target objects.
   */
  public function __construct($parent, $key, $targetClassName = null)
  {
    $this-&gt;parent = $parent;
    $this-&gt;key = $key;
    $this-&gt;targetClassName = $targetClassName;
  }

  /**
   * Makes sure that this relation has the right parent and key.
   *
   * @param $parent
   * @param $key
   *
   * @throws \Exception
   */
  private function ensureParentAndKey($parent, $key)
  {
    if (!$this-&gt;parent) {
      $this-&gt;parent = $parent;
    }
    if (!$this-&gt;key) {
      $this-&gt;key = $key;
    }
    if ($this-&gt;parent != $parent) {
      throw new \Exception('Internal Error. Relation retrieved from two different Objects.');
    }
    if ($this-&gt;key != $key) {
      throw new \Exception('Internal Error. Relation retrieved from two different keys.');
    }
  }

  /**
   * Adds a ParseObject or an array of ParseObjects to the relation.
   *
   * @param mixed $objects The item or items to add.
   */
  public function add($objects)
  {
    if (!is_array($objects)) {
      $objects = [$objects];
    }
    $operation = new ParseRelationOperation($objects, null);
    $this-&gt;targetClassName = $operation-&gt;_getTargetClass();
    $this-&gt;parent-&gt;_performOperation($this-&gt;key, $operation);
  }

  /**
   * Removes a ParseObject or an array of ParseObjects from this relation.
   *
   * @param mixed $objects The item or items to remove.
   */
  public function remove($objects)
  {
    if (!is_array($objects)) {
      $objects = [$objects];
    }
    $operation = new ParseRelationOperation(null, $objects);
    $this-&gt;targetClassName = $operation-&gt;_getTargetClass();
    $this-&gt;parent-&gt;_performOperation($this-&gt;key, $operation);
  }

  /**
   * Returns the target classname for the relation.
   *
   * @return string
   */
  public function getTargetClass()
  {
    return $this-&gt;targetClassName;
  }

  /**
   * Set the target classname for the relation.
   *
   * @param $className
   */
  public function setTargetClass($className)
  {
    $this-&gt;targetClassName = $className;
  }

  /**
   * Set the parent object for the relation.
   *
   * @param $parent
   */
  public function setParent($parent) {
    $this-&gt;parent = $parent;
  }

  /**
   * Gets a query that can be used to query the objects in this relation.
   *
   * @return ParseQuery That restricts the results to objects in this relations.
   */
  public function getQuery()
  {
    $query = new ParseQuery($this-&gt;targetClassName);
    $query-&gt;relatedTo('object', $this-&gt;parent-&gt;_toPointer());
    $query-&gt;relatedTo('key', $this-&gt;key);
    return $query;
  }
}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>